sudo apt update && sudo apt install -y gcc gfortran openmpi-bin libopenmpi-dev make libopenblas-dev
git clone https://github.com/zturtleman/hpl.git && cd hpl
cp setup/Make.Linux_PII_CBLAS Make.Linux
sed -i 's/CC = gcc/CC = mpicc/; s/FC = g77/FC = mpif90/; s/BLAS_LIB = .*/BLAS_LIB = -lopenblas -lpthread/; s/MPdir = .*/MPdir = \/usr/; s/MPinc = .*/MPinc = -I\/usr\/include\/openmpi/; s/MPlib = .*/MPlib = -L\/usr\/lib\/x86_64-linux-gnu -lmpi/' Make.Linux
echo -e "HPLinpack benchmark input file\nInnovative Computing Laboratory, University of Tennessee\nHPL.out      output file name (if any)\n6            device out (6=stdout,7=stderr,file)\n1            # of problems sizes (N)\n2048         Ns\n1            # of NBs\n256          NBs\n0            PMAP process mapping (0=Row-,1=Column-major)\n1            # of process grids (P x Q)\n2            Ps\n2            Qs\n16.0         threshold\n1            # of panel fact\n2            PFACTs (0=left,1=Crout,2=Right)\n1            # of recursive stopping criterium\n4            NBMINs\n1            # of panels in recursion\n2            NDIVs\n1            # of recursive panel fact.\n1            RFACTs (0=left,1=Crout,2=Right)\n1            # of broadcast\n1            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)\n1            # of lookahead depth\n1            DEPTHs (>=0)\n2            SWAP (0=bin-exch,1=long,2=mix)\n64           swapping threshold\n0            L1 in (0=transposed,1=no-transposed) form\n0            U  in (0=transposed,1=no-transposed) form\n1            Equilibration (0=no,1=yes)\n8            memory alignment in double (>= 8)" > HPL.dat
make clean && make arch=Linux
mpirun -np 4 ./bin/Linux/xhpl > hpl_result.txt
